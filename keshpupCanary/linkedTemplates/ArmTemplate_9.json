{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "Keshpupcanary"
		},
		"AML_servicePrincipalKey": {
			"type": "secureString",
			"metadata": "Secure string for 'servicePrincipalKey' of 'AML'"
		},
		"hdiVNetLS_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'hdiVNetLS'"
		},
		"keshhdioutboundvnet_password": {
			"type": "secureString",
			"metadata": "Secure string for 'password' of 'keshhdioutboundvnet'"
		},
		"AML_properties_typeProperties_subscriptionId": {
			"type": "string",
			"defaultValue": "1e42591f-1f0c-4c5a-b7f2-a268f6105ec5"
		},
		"AML_properties_typeProperties_resourceGroupName": {
			"type": "string",
			"defaultValue": "keshADF_test"
		},
		"AML_properties_typeProperties_servicePrincipalId": {
			"type": "string",
			"defaultValue": "fe273844-c808-40b8-ad85-94a46f737731"
		},
		"AML_properties_typeProperties_tenant": {
			"type": "string",
			"defaultValue": "72f988bf-86f1-41af-91ab-2d7cd011db47"
		},
		"hdiVNetLS_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "admin"
		},
		"keshhdioutboundvnet_properties_typeProperties_userName": {
			"type": "string",
			"defaultValue": "admin"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/databricks')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Notebook1",
						"type": "DatabricksNotebook",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"notebookPath": "/Users/kesharma@microsoft.com/pythonNotebook"
						},
						"linkedServiceName": {
							"referenceName": "AzureDatabricks2",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-05-04T06:48:57Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/functionWithMI')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "FunctionWithMI",
						"type": "AzureFunctionActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"functionName": "Accepted",
							"method": "GET",
							"headers": {}
						},
						"linkedServiceName": {
							"referenceName": "AzureFunction1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/keshAML')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Machine Learning Execute Pipeline1",
						"type": "AzureMLExecutePipeline",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"experimentName": "test",
							"mlPipelineParameters": {
								"param_batch_size": 5,
								"param_sleep_seconds": 60,
								"param_should_throw": "false"
							},
							"mlPipelineId": "b91ecfe6-f614-4c1a-a7f8-7df5aa9e41ad"
						},
						"linkedServiceName": {
							"referenceName": "AzureMLService1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-02-07T08:52:17Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/keshAMLTestForDataPath')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Machine Learning Execute Pipeline1",
						"type": "AzureMLExecutePipeline",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"experimentName": "test",
							"mlPipelineParameters": {
								"param_batch_size": {
									"param_should_throw": "false"
								},
								"param_sleep_seconds": 60,
								"param_should_throw": "false"
							},
							"mlPipelineId": "b91ecfe6-f614-4c1a-a7f8-7df5aa9e41ad"
						},
						"linkedServiceName": {
							"referenceName": "AzureMLService1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-05-04T06:48:56Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/pipeline1')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Hive1",
						"type": "HDInsightHive",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"scriptPath": "adfgetstarted/hivescripts/partitionweblogs.hql",
							"scriptLinkedService": {
								"referenceName": "heshhdistorageblob",
								"type": "LinkedServiceReference"
							}
						},
						"linkedServiceName": {
							"referenceName": "linkedService2",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-05-24T13:41:24Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/pipeline10')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Hive1",
						"type": "HDInsightHive",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"scriptPath": "Nahi_de_raha_gth_JustCheckingProvisioning",
							"scriptLinkedService": {
								"referenceName": "AzureBlobStorage1",
								"type": "LinkedServiceReference"
							}
						},
						"linkedServiceName": {
							"referenceName": "hdiLinkedService",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/pipeline5')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Azure Function1",
						"type": "AzureFunctionActivity",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"functionName": "Accepted",
							"method": "GET",
							"headers": {}
						},
						"linkedServiceName": {
							"referenceName": "AzureFunction1",
							"type": "LinkedServiceReference"
						},
						"authentication": {
							"type": "Msi"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": [],
				"lastPublishTime": "2021-05-04T06:48:56Z"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/pipeline8')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Custom1",
						"type": "Custom",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"command": "helloworld.exe",
							"referenceObjects": {
								"linkedServices": [],
								"datasets": []
							}
						},
						"linkedServiceName": {
							"referenceName": "AzureBatch1",
							"type": "LinkedServiceReference"
						}
					}
				],
				"policy": {
					"elapsedTimeMetric": {},
					"cancelAfter": {}
				},
				"annotations": []
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/AML')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "59EjmHpWVTLeKSHittHv1RmNzcjA2yrDqU8g7A+PKIs=\n\ne87e775f-270b-4c91-aebc-0cb346ecf11e",
				"annotations": [],
				"type": "AzureMLService",
				"typeProperties": {
					"subscriptionId": "[parameters('AML_properties_typeProperties_subscriptionId')]",
					"resourceGroupName": "[parameters('AML_properties_typeProperties_resourceGroupName')]",
					"mlWorkspaceName": "keshAMLtestWorkspace",
					"servicePrincipalId": "[parameters('AML_properties_typeProperties_servicePrincipalId')]",
					"servicePrincipalKey": {
						"type": "SecureString",
						"value": "[parameters('AML_servicePrincipalKey')]"
					},
					"tenant": "[parameters('AML_properties_typeProperties_tenant')]"
				},
				"connectVia": {
					"referenceName": "VnetIR",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/hdiVNetLS')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "HDInsight",
				"typeProperties": {
					"clusterUri": "https://keshhdivnet.azurehdinsight.net",
					"userName": "[parameters('hdiVNetLS_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('hdiVNetLS_password')]"
					},
					"isEspEnabled": false,
					"linkedServiceName": {
						"referenceName": "AzureBlobStorage1",
						"type": "LinkedServiceReference"
					}
				},
				"connectVia": {
					"referenceName": "integrationRuntime5",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/keshhdioutboundvnet')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"annotations": [],
				"type": "HDInsight",
				"typeProperties": {
					"clusterUri": "https://keshhdieunat-int.azurehdinsight.net",
					"userName": "[parameters('keshhdioutboundvnet_properties_typeProperties_userName')]",
					"password": {
						"type": "SecureString",
						"value": "[parameters('keshhdioutboundvnet_password')]"
					},
					"isEspEnabled": false,
					"linkedServiceName": {
						"referenceName": "AzureBlobStorage1",
						"type": "LinkedServiceReference"
					}
				},
				"connectVia": {
					"referenceName": "integrationRuntime5",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CDM_Repro')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "Parquet2",
								"type": "DatasetReference"
							},
							"name": "AzureSubscriptionProfileRead"
						}
					],
					"sinks": [
						{
							"linkedService": {
								"referenceName": "AzureDataLakeStorage1",
								"type": "LinkedServiceReference"
							},
							"schemaLinkedService": {
								"referenceName": "AzureDataLakeStorage1",
								"type": "LinkedServiceReference"
							},
							"name": "AzureSubscriptionProfileOutEDL"
						}
					],
					"transformations": [],
					"script": "source(output(\n\t\tSubscriptionId as string,\n\t\tSubscriptionCreatedDate as timestamp,\n\t\tSubscriptionStartDate as timestamp,\n\t\tSubscriptionStatusCurrent as string,\n\t\tMCRecordCreatedDate as timestamp,\n\t\tMCRecordUpdatedDate as timestamp\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tformat: 'parquet') ~> AzureSubscriptionProfileRead\nAzureSubscriptionProfileRead sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tSubscriptionId as string,\n\t\tSubscriptionCreatedDate as string,\n\t\tSubscriptionStartDate as string,\n\t\tSubscriptionStatusCurrent as string,\n\t\tMCRecordCreatedDate as string,\n\t\tMCRecordUpdatedDate as string\n\t),\n\tentity: 'SubscriptionProfile.cdm.json/SubscriptionProfile',\n\tformat: 'cdm',\n\tmanifestType: 'manifest',\n\tpartitionPath: (concat(toString(currentUTC(),'yyyy'),'/',toString(currentUTC(),'MM'),'/',toString(currentUTC(),'dd'))),\n\tfolderPath: 'CDM',\n\tfileSystem: 'adhocextract',\n\tsubformat: 'parquet',\n\tcorpusPath: 'CDM',\n\tcorpusStore: 'adlsgen2',\n\tadlsgen2_fileSystem: 'adhocextract',\n\ttruncate: false,\n\tumask: 0022,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tSubscriptionId,\n\t\tSubscriptionCreatedDate,\n\t\tSubscriptionStartDate,\n\t\tSubscriptionStatusCurrent,\n\t\tMCRecordCreatedDate,\n\t\tMCRecordUpdatedDate\n\t)) ~> AzureSubscriptionProfileOutEDL"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/CDM_load_issue')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"linkedService": {
								"referenceName": "AzureDataLakeStorage1",
								"type": "LinkedServiceReference"
							},
							"name": "source1"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "DelimitedText2",
								"type": "DatasetReference"
							},
							"name": "sink1"
						}
					],
					"transformations": [],
					"script": "source(output(\n\t\tId as string,\n\t\tSinkCreatedOn as timestamp,\n\t\tSinkModifiedOn as timestamp,\n\t\tstatecode as long,\n\t\tstatuscode as long,\n\t\tmsft_entrywindowinterval as long,\n\t\tmodifiedonbehalfby as string,\n\t\tmodifiedonbehalfby_entitytype as string,\n\t\tmsft_addresscountryid as string,\n\t\tmsft_addresscountryid_entitytype as string,\n\t\towninguser as string,\n\t\towninguser_entitytype as string,\n\t\tcreatedonbehalfby as string,\n\t\tcreatedonbehalfby_entitytype as string,\n\t\towningbusinessunit as string,\n\t\towningbusinessunit_entitytype as string,\n\t\towningteam as string,\n\t\towningteam_entitytype as string,\n\t\tmodifiedby as string,\n\t\tmodifiedby_entitytype as string,\n\t\tcreatedby as string,\n\t\tcreatedby_entitytype as string,\n\t\tmsft_addressstateprovinceid as string,\n\t\tmsft_addressstateprovinceid_entitytype as string,\n\t\tmsft_facilitytypeid as string,\n\t\tmsft_facilitytypeid_entitytype as string,\n\t\tmsft_facilitygroupid as string,\n\t\tmsft_facilitygroupid_entitytype as string,\n\t\tmsft_reopenphaseid as string,\n\t\tmsft_reopenphaseid_entitytype as string,\n\t\townerid as string,\n\t\townerid_entitytype as string,\n\t\tcreatedonbehalfbyyominame as string,\n\t\tmsft_facilitygroupidname as string,\n\t\towneridname as string,\n\t\tcreatedon as timestamp,\n\t\toverriddencreatedon as timestamp,\n\t\tmsft_addresslatitude as string,\n\t\tmsft_addressstreet2 as string,\n\t\tstageid as string,\n\t\timportsequencenumber as long,\n\t\tmodifiedbyyominame as string,\n\t\tmsft_addressstreet1 as string,\n\t\tmsft_facilitynumber as string,\n\t\tutcconversiontimezonecode as long,\n\t\tcreatedbyyominame as string,\n\t\tmsft_facilityid as string,\n\t\tmodifiedbyname as string,\n\t\ttimezoneruleversionnumber as long,\n\t\ttraversedpath as string,\n\t\tmsft_addresscountryidname as string,\n\t\towneridtype as string,\n\t\tmsft_addresslongitude as string,\n\t\tprocessid as string,\n\t\tmsft_addresscountry as string,\n\t\towneridyominame as string,\n\t\tmodifiedon as timestamp,\n\t\tmsft_addressstateprovince as string,\n\t\tmsft_description as string,\n\t\tmodifiedonbehalfbyyominame as string,\n\t\tcreatedbyname as string,\n\t\tmsft_reopenphaseidname as string,\n\t\tmsft_addressstateprovinceidname as string,\n\t\tcreatedonbehalfbyname as string,\n\t\tmsft_facilitytypeidname as string,\n\t\tmsft_addresspostalcode as string,\n\t\tmodifiedonbehalfbyname as string,\n\t\tmsft_addresscity as string,\n\t\tversionnumber as long,\n\t\tmsft_name as string,\n\t\trts_entitytype as long,\n\t\trts_ld as string,\n\t\trts_campuscode as string,\n\t\trts_physicalcos as string,\n\t\trts_boe as string,\n\t\trts_sitetype as string,\n\t\trts_campusname as string,\n\t\trts_internalname as string\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false,\n\tlimit: 3,\n\tignoreNoFilesFound: false,\n\tentity: 'msft_facility',\n\tformat: 'cdm',\n\tmanifestType: 'manifest',\n\tlocal: true,\n\tfolderPath: 'CMD_test',\n\tfileSystem: 'adhocextract',\n\ttimestampFormats: ['yyyy-MM-dd\\'T\\'HH:mm:ss','yyyy-MM-dd\\'T\\'HH:mm:ss\\'Z\\'','MM/dd/yyyy HH:mm']) ~> source1\nsource1 sink(allowSchemaDrift: false,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string,\n\t\tColumn_7 as string,\n\t\tColumn_8 as string,\n\t\tColumn_9 as string,\n\t\tColumn_10 as string,\n\t\tColumn_11 as string,\n\t\tColumn_12 as string,\n\t\tColumn_13 as string,\n\t\tColumn_14 as string,\n\t\tColumn_15 as string,\n\t\tColumn_16 as string,\n\t\tColumn_17 as string,\n\t\tColumn_18 as string,\n\t\tColumn_19 as string,\n\t\tColumn_20 as string,\n\t\tColumn_21 as string,\n\t\tColumn_22 as string,\n\t\tColumn_23 as string,\n\t\tColumn_24 as string,\n\t\tColumn_25 as string,\n\t\tColumn_26 as string,\n\t\tColumn_27 as string,\n\t\tColumn_28 as string,\n\t\tColumn_29 as string,\n\t\tColumn_30 as string,\n\t\tColumn_31 as string,\n\t\tColumn_32 as string,\n\t\tColumn_33 as string,\n\t\tColumn_34 as string,\n\t\tColumn_35 as string,\n\t\tColumn_36 as string,\n\t\tColumn_37 as string,\n\t\tColumn_38 as string,\n\t\tColumn_39 as string,\n\t\tColumn_40 as string,\n\t\tColumn_41 as string,\n\t\tColumn_42 as string,\n\t\tColumn_43 as string,\n\t\tColumn_44 as string,\n\t\tColumn_45 as string,\n\t\tColumn_46 as string,\n\t\tColumn_47 as string,\n\t\tColumn_48 as string,\n\t\tColumn_49 as string,\n\t\tColumn_50 as string,\n\t\tColumn_51 as string,\n\t\tColumn_52 as string,\n\t\tColumn_53 as string,\n\t\tColumn_54 as string,\n\t\tColumn_55 as string,\n\t\tColumn_56 as string,\n\t\tColumn_57 as string,\n\t\tColumn_58 as string,\n\t\tColumn_59 as string,\n\t\tColumn_60 as string,\n\t\tColumn_61 as string,\n\t\tColumn_62 as string,\n\t\tColumn_63 as string,\n\t\tColumn_64 as string,\n\t\tColumn_65 as string,\n\t\tColumn_66 as string,\n\t\tColumn_67 as string,\n\t\tColumn_68 as string,\n\t\tColumn_69 as string,\n\t\tColumn_70 as string\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> sink1"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/FlattenIssueDF')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "psi101002_20201119_2225",
								"type": "DatasetReference"
							},
							"name": "InputJson"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "FlattenIssueCsvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkAudit"
						},
						{
							"dataset": {
								"referenceName": "FlattenIssueCsvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkEvent"
						},
						{
							"dataset": {
								"referenceName": "FlattenIssueCsvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkChecks"
						},
						{
							"dataset": {
								"referenceName": "FlattenIssueCsvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkChecksComps"
						},
						{
							"dataset": {
								"referenceName": "FlattenIssueCsvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkSurcharges"
						},
						{
							"dataset": {
								"referenceName": "FlattenIssueCsvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkChecksPayments"
						},
						{
							"dataset": {
								"referenceName": "FlattenIssueCsvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkResponsibleEmployees"
						}
					],
					"transformations": [
						{
							"name": "FlattenCheck"
						},
						{
							"name": "FlattenEvents"
						},
						{
							"name": "AggregateCheckCount"
						},
						{
							"name": "AuditLine"
						},
						{
							"name": "FlattenComps"
						},
						{
							"name": "FlattenSurcharge"
						},
						{
							"name": "FlattenPayments"
						},
						{
							"name": "FlattenResponsibleEmpolyees"
						}
					],
					"script": "parameters{\n\tsource_location as string ('adhocextract/FlattenIssueInput'),\n\ttime_stamp as string (''),\n\tdob as string (''),\n\tbatch_window as string (''),\n\tstart_time as string ('')\n}\nsource(output(\n\t\tstoreId as string,\n\t\tdob as string,\n\t\tmarker as string,\n\t\tmoreDataImmediatelyAvailable as boolean,\n\t\tlink as string,\n\t\tchecks as (items as (responsibleEmployeeId as string, categories as (id as string, name as string, type as string)[], netAmount as double, orderMode as (id as string, label as string), period as (id as string, label as string), originalPrice as double, quantity as double, seat as string, revenue as boolean, processedInKitchen as boolean, giftCard as boolean, id as string, typeId as string, label as string, amount as double, createdOn as string, responsibleEmployees as (employee as (id as string, name as string)))[], responsibleEmployees as (shiftId as string, isTippableEmployee as boolean, roleId as string, roleName as string, id as string, name as string, time as string)[], terminalId as string, grossAmount as double, grandAmount as double, id as string, printedCheckId as string, netAmount as double, total as double, isRefund as boolean, training as boolean, closed as boolean, groupInfo as (id as string, label as string), guestCounting as (guests as double, mode as string), revenueCenter as (id as string, label as string), period as (id as string, label as string), comps as (type as string, note as string, linkedItems as (id as string, amount as double)[], id as string, typeId as string, label as string, amount as double, createdOn as string, responsibleEmployees as (employee as (id as string, name as string)))[], surcharges as (rate as double, type as string, accounting as string, linkedItems as string[], taxableSales as double, id as string, typeId as string, label as string, amount as double, createdOn as string)[], payments as (tip as double, type as string, card as string, id as string, typeId as string, label as string, amount as double, createdOn as string, responsibleEmployees as (employee as (id as string, name as string)))[], events as (time as string, type as string)[], isTaxExemptApplied as boolean)[]\n\t),\n\tallowSchemaDrift: false,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tdocumentForm: 'singleDocument',\n\twildcardPaths:['FlattenIssueInput/*']) ~> InputJson\nInputJson foldDown(unroll(checks, checks),\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tmarker,\n\t\tmoreDataImmediatelyAvailable,\n\t\tlink,\n\t\t{check.terminalId} = checks.terminalId,\n\t\t{checks.grossAmount} = checks.grossAmount,\n\t\tcheckgrandAmount = checks.grandAmount,\n\t\tcheckid = checks.id,\n\t\tcheckprintedCheckId = checks.printedCheckId,\n\t\tchecknetAmount = checks.netAmount,\n\t\tcheckstotal = checks.total,\n\t\tcheckisRefund = checks.isRefund,\n\t\tcheckstraining = checks.training,\n\t\tchecksclosed = checks.closed,\n\t\tchecksgroupInfoid = checks.groupInfo.id,\n\t\tchecksgroupInfolabel = checks.groupInfo.label,\n\t\tchecksperiodid = checks.period.id,\n\t\tchecksperiodlabel = checks.period.label,\n\t\tchecksisTaxExemptApplied = checks.isTaxExemptApplied,\n\t\titems = checks.items,\n\t\tresponsibleEmployees = checks.responsibleEmployees,\n\t\tevents = checks.events,\n\t\tsurcharges = checks.surcharges,\n\t\tpayments = checks.payments,\n\t\tcomps = checks.comps,\n\t\t{revenueCenter.id} = checks.revenueCenter.id,\n\t\t{revenueCenter.label} = checks.revenueCenter.label,\n\t\t{guestCounting.guests} = checks.guestCounting.guests,\n\t\t{guestCounting.mode} = checks.guestCounting.mode\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenCheck\nFlattenCheck foldDown(unroll(events, events),\n\tmapColumn(\n\t\tstoreId,\n\t\tchecksisTaxExemptApplied = events.time,\n\t\titems = events.type,\n\t\tcheckprintedCheckId,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenEvents\nFlattenCheck aggregate(RowCount = countDistinct(storeId, checkprintedCheckId )) ~> AggregateCheckCount\nAggregateCheckCount derive(Pipeline = \"Step 2 : NCR Refine\",\n\t\t{Date of Business} = $dob,\n\t\t{Batch Window} = $batch_window,\n\t\t{Row Count} = RowCount,\n\t\t{Pipeline Start Dttm} = $start_time,\n\t\t{Pipeline End Dttm} = toString(fromUTC(currentTimestamp(),'MST'),\"HH:mm:ss\"),\n\t\t{Pipeline Status} = \"Success\") ~> AuditLine\nFlattenCheck foldDown(unroll(comps, comps),\n\tmapColumn(\n\t\tstoreId,\n\t\tcomps,\n\t\tprintedCheckId = checkprintedCheckId,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenComps\nFlattenCheck foldDown(unroll(surcharges, surcharges),\n\tmapColumn(\n\t\tstoreId,\n\t\tprintedCheckId = checkprintedCheckId,\n\t\tsurcharges,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenSurcharge\nFlattenCheck foldDown(unroll(payments, payments),\n\tmapColumn(\n\t\tstoreId,\n\t\tprintedCheckId = checkprintedCheckId,\n\t\tpayments,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: false) ~> FlattenPayments\nFlattenCheck foldDown(unroll(responsibleEmployees, responsibleEmployees),\n\tmapColumn(\n\t\tstoreId,\n\t\tprintedCheckId = checkprintedCheckId,\n\t\tresponsibleEmpolyees = responsibleEmployees,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenResponsibleEmpolyees\nAuditLine sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string\n\t),\n\tpartitionFileNames:[(concat('Audit_', toString(currentUTC(),'yyyyMMdd_HHmm'),'.csv'))],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tPipeline,\n\t\t{Date of Business},\n\t\t{Batch Window},\n\t\t{Row Count},\n\t\t{Pipeline Start Dttm},\n\t\t{Pipeline End Dttm},\n\t\t{Pipeline Status}\n\t),\n\tpartitionBy('hash', 1)) ~> SinkAudit\nFlattenEvents sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tchecksisTaxExemptApplied,\n\t\titems,\n\t\tcheckprintedCheckId\n\t)) ~> SinkEvent\nFlattenCheck sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tmarker,\n\t\tlink,\n\t\tterminalId = {check.terminalId},\n\t\tgrossAmount = {checks.grossAmount},\n\t\tcheckgrandAmount,\n\t\tcheckid,\n\t\tprintedCheckId = checkprintedCheckId,\n\t\tchecknetAmount,\n\t\tcheckstotal,\n\t\tcheckisRefund,\n\t\tcheckstraining,\n\t\tchecksclosed,\n\t\tchecksgroupInfoid,\n\t\tchecksgroupInfolabel,\n\t\tchecksperiodid,\n\t\tchecksperiodlabel,\n\t\tchecksisTaxExemptApplied,\n\t\t{guestCounting.guests},\n\t\t{guestCounting.mode},\n\t\t{revenueCenter.id},\n\t\t{revenueCenter.label}\n\t)) ~> SinkChecks\nFlattenComps sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tprintedCheckId,\n\t\tamount = comps.amount,\n\t\tcreatedOn = comps.createdOn,\n\t\tid = comps.id,\n\t\tlabel = comps.label,\n\t\tnote = comps.note,\n\t\t{responsibleEmployees.employee.id} = comps.responsibleEmployees.employee.id,\n\t\t{responsibleEmployees.employee.name} = comps.responsibleEmployees.employee.name,\n\t\ttype = comps.type,\n\t\ttypeId = comps.typeId\n\t)) ~> SinkChecksComps\nFlattenSurcharge sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\t{surchages.linkedItems} = surcharges.linkedItems,\n\t\trate = surcharges.rate,\n\t\ttype = surcharges.type,\n\t\taccounting = surcharges.accounting,\n\t\ttaxableSales = surcharges.taxableSales,\n\t\tid = surcharges.id,\n\t\ttypeId = surcharges.typeId,\n\t\tlabel = surcharges.label,\n\t\tamount = surcharges.amount,\n\t\tcreatedOn = surcharges.createdOn,\n\t\tprintedCheckId\n\t)) ~> SinkSurcharges\nFlattenPayments sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\ttip = payments.tip,\n\t\ttype = payments.type,\n\t\tcard = payments.card,\n\t\tid = payments.id,\n\t\ttypeId = payments.typeId,\n\t\tlabel = payments.label,\n\t\tamount = payments.amount,\n\t\tcreatedOn = payments.createdOn,\n\t\t{responsibleEmployees.employee.id} = payments.responsibleEmployees.employee.id,\n\t\t{responsibleEmployees.employee.name} = payments.responsibleEmployees.employee.name,\n\t\tprintedCheckId\n\t)) ~> SinkChecksPayments\nFlattenResponsibleEmpolyees sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string,\n\t\tColumn_6 as string\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tprintedCheckId,\n\t\t{responsibleEmployees.employee.id} = responsibleEmpolyees.id,\n\t\tisTippableEmployee = responsibleEmpolyees.isTippableEmployee,\n\t\t{responsibleEmployees.employee.name} = responsibleEmpolyees.name,\n\t\troleId = responsibleEmpolyees.roleId,\n\t\troleName = responsibleEmpolyees.roleName,\n\t\tshiftId = responsibleEmpolyees.shiftId,\n\t\ttime = responsibleEmpolyees.time\n\t)) ~> SinkResponsibleEmployees"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('factoryName'), '/FlattenIssueNewJson')]",
			"type": "Microsoft.DataFactory/factories/dataflows",
			"apiVersion": "2018-06-01",
			"properties": {
				"type": "MappingDataFlow",
				"typeProperties": {
					"sources": [
						{
							"dataset": {
								"referenceName": "psi101002_20201119_2225",
								"type": "DatasetReference"
							},
							"name": "InputJson"
						}
					],
					"sinks": [
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkChecks"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkVoids"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkAudit"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkEvent"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkChecksComps"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkSurcharges"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkChecksPayments"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkResponsibleEmployees"
						},
						{
							"dataset": {
								"referenceName": "csvOutput",
								"type": "DatasetReference"
							},
							"name": "SinkChecksItems"
						}
					],
					"transformations": [
						{
							"name": "FlattenCheck"
						},
						{
							"name": "FlattenEvents"
						},
						{
							"name": "AggregateCheckCount"
						},
						{
							"name": "AuditLine"
						},
						{
							"name": "FlattenVoids"
						},
						{
							"name": "FlattenComps"
						},
						{
							"name": "FlattenSurcharge"
						},
						{
							"name": "FlattenPayments"
						},
						{
							"name": "FlattenResponsibleEmpolyees"
						},
						{
							"name": "FlattenItems"
						},
						{
							"name": "FlattenChecks"
						}
					],
					"script": "parameters{\n\tsource_location as string ('Inbound/Raw/NCR_Pulse/Sales/Stream/Incremental/20201119/2225'),\n\ttime_stamp as string (''),\n\tdob as string (''),\n\tbatch_window as string (''),\n\tstart_time as string ('')\n}\nsource(output(\n\t\tchecks as (clears as (amount as double, createdOn as string, id as string, label as string, linkedItems as (amount as double, id as integer)[], responsibleEmployees as (employee as (id as integer, name as string)), type as string, typeId as integer)[], closed as boolean, comps as (amount as double, createdOn as string, id as integer, label as string, linkedItems as (amount as double, id as integer)[], note as string, responsibleEmployees as (employee as (id as integer, name as string), manager as (id as integer, name as string)), type as string, typeId as short)[], events as (time as string, type as string)[], grandAmount as double, grossAmount as double, groupInfo as (id as integer, label as string), guestCounting as (guests as double, mode as string), id as integer, isRefund as boolean, isTaxExemptApplied as boolean, items as (amount as double, categories as (id as short, name as string, type as string)[], createdOn as string, giftCard as boolean, id as integer, label as string, modifierInfo as (id as (id as short, label as string), type as string), netAmount as double, orderMode as (id as short, label as string), originalPrice as double, parentItemId as integer, period as (id as short, label as string), processedInKitchen as boolean, quantity as double, responsibleEmployeeId as integer, responsibleEmployees as (employee as (id as integer, name as string)), revenue as boolean, seat as boolean, typeId as integer)[], netAmount as double, payments as (amount as double, card as string, createdOn as string, id as integer, label as string, responsibleEmployees as (employee as (id as integer, name as string)), tip as double, type as string, typeId as short)[], period as (id as short, label as string), printedCheckId as integer, responsibleEmployees as (id as integer, isTippableEmployee as boolean, name as string, roleId as short, roleName as string, shiftId as boolean, time as string)[], revenueCenter as (id as short, label as string), surcharges as (accounting as string, amount as double, createdOn as string, id as string, label as string, linkedItems as integer[], rate as double, taxableSales as double, type as string, typeId as short)[], terminalId as short, total as double, training as boolean, voids as (amount as double, createdOn as string, id as string, label as string, linkedItems as (amount as double, id as integer)[], responsibleEmployees as (employee as (id as integer, name as string), manager as (id as integer, name as string)), type as string, typeId as short)[])[],\n\t\tdob as string,\n\t\tlink as string,\n\t\tmarker as string,\n\t\tmoreDataImmediatelyAvailable as string,\n\t\tstoreId as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false,\n\tdocumentForm: 'singleDocument') ~> InputJson\nInputJson foldDown(unroll(checks, checks),\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tmarker,\n\t\tmoreDataImmediatelyAvailable,\n\t\tlink,\n\t\t{check.terminalId} = checks.terminalId,\n\t\t{checks.grossAmount} = checks.grossAmount,\n\t\tcheckgrandAmount = checks.grandAmount,\n\t\tcheckid = checks.id,\n\t\tcheckprintedCheckId = checks.printedCheckId,\n\t\tchecknetAmount = checks.netAmount,\n\t\tcheckstotal = checks.total,\n\t\tcheckisRefund = checks.isRefund,\n\t\tcheckstraining = checks.training,\n\t\tchecksclosed = checks.closed,\n\t\tchecksgroupInfoid = checks.groupInfo.id,\n\t\tchecksgroupInfolabel = checks.groupInfo.label,\n\t\tchecksperiodid = checks.period.id,\n\t\tchecksperiodlabel = checks.period.label,\n\t\tchecksisTaxExemptApplied = checks.isTaxExemptApplied,\n\t\t{revenueCenter.id} = checks.revenueCenter.id,\n\t\t{revenueCenter.label} = checks.revenueCenter.label,\n\t\t{guestCounting.guests} = checks.guestCounting.guests,\n\t\t{guestCounting.mode} = checks.guestCounting.mode\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: false) ~> FlattenCheck\nInputJson foldDown(unroll(checks.events, checks),\n\tmapColumn(\n\t\tstoreId,\n\t\teventTime = checks.events.time,\n\t\teventType = checks.events.type,\n\t\tdob,\n\t\tcheckprintedCheckId = checks.printedCheckId\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenEvents\nFlattenChecks aggregate(RowCount = countDistinct(storeId, checkprintedCheckId )) ~> AggregateCheckCount\nAggregateCheckCount derive(Pipeline = \"Step 2 : NCR Refine\",\n\t\t{Date of Business} = $dob,\n\t\t{Batch Window} = $batch_window,\n\t\t{Row Count} = RowCount,\n\t\t{Pipeline Start Dttm} = $start_time,\n\t\t{Pipeline End Dttm} = toString(fromUTC(currentTimestamp(),'MST'),\"HH:mm:ss\"),\n\t\t{Pipeline Status} = \"Success\") ~> AuditLine\nInputJson foldDown(unroll(checks.voids, checks),\n\tmapColumn(\n\t\tstoreId,\n\t\tvoids = checks.voids,\n\t\tcheckprintedCheckId = checks.printedCheckId,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenVoids\nInputJson foldDown(unroll(checks.comps, checks),\n\tmapColumn(\n\t\tstoreId,\n\t\tcomps = checks.comps,\n\t\tprintedCheckId = checks.printedCheckId,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenComps\nInputJson foldDown(unroll(checks.surcharges, checks.surcharges),\n\tmapColumn(\n\t\tstoreId,\n\t\tprintedCheckId = checks.printedCheckId,\n\t\tsurcharges = checks.surcharges,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenSurcharge\nInputJson foldDown(unroll(checks.payments, checks.payments),\n\tmapColumn(\n\t\tstoreId,\n\t\tprintedCheckId = checks.printedCheckId,\n\t\tpayments = checks.payments,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenPayments\nInputJson foldDown(unroll(checks.responsibleEmployees, checks),\n\tmapColumn(\n\t\tstoreId,\n\t\tprintedCheckId = checks.printedCheckId,\n\t\tresponsibleEmpolyees = checks.responsibleEmployees,\n\t\tdob\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenResponsibleEmpolyees\nInputJson foldDown(unroll(checks.items, checks),\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tprintedCheckId = checks.printedCheckId,\n\t\titems = checks.items\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenItems\nInputJson foldDown(unroll(checks, checks),\n\tmapColumn(\n\t\tcheckprintedCheckId = checks.printedCheckId,\n\t\tdob,\n\t\tlink,\n\t\tmarker,\n\t\tmoreDataImmediatelyAvailable,\n\t\tstoreId\n\t),\n\tskipDuplicateMapInputs: false,\n\tskipDuplicateMapOutputs: false) ~> FlattenChecks\nFlattenCheck sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tmarker,\n\t\tmoreDataImmediatelyAvailable,\n\t\tlink,\n\t\tterminalId = {check.terminalId},\n\t\tgrossAmount = {checks.grossAmount},\n\t\tcheckgrandAmount,\n\t\tcheckid,\n\t\tcheckprintedCheckId,\n\t\tchecknetAmount,\n\t\tcheckstotal,\n\t\tcheckisRefund,\n\t\tcheckstraining,\n\t\tchecksclosed,\n\t\tchecksgroupInfoid,\n\t\tchecksgroupInfolabel,\n\t\tchecksperiodid,\n\t\tchecksperiodlabel,\n\t\tchecksisTaxExemptApplied,\n\t\tid = {revenueCenter.id},\n\t\tlabel = {revenueCenter.label},\n\t\tguests = {guestCounting.guests},\n\t\tmode = {guestCounting.mode}\n\t)) ~> SinkChecks\nFlattenVoids sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tamount = voids.amount,\n\t\tcreatedOn = voids.createdOn,\n\t\tid = voids.id,\n\t\tlabel = voids.label,\n\t\t{voids.linkedItems} = voids.linkedItems,\n\t\t{responsibleEmployees.employee.id} = voids.responsibleEmployees.employee.id,\n\t\t{responsibleEmployees.employee.name} = voids.responsibleEmployees.employee.name,\n\t\ttype = voids.type,\n\t\ttypeId = voids.typeId,\n\t\t{responsibleEmployees.employee.manager.id} = voids.responsibleEmployees.manager.id,\n\t\t{responsibleEmployees.employee.manager.name} = voids.responsibleEmployees.manager.name,\n\t\tprintedCheckId = checkprintedCheckId\n\t)) ~> SinkVoids\nAuditLine sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tpartitionFileNames:[(concat('Audit_', toString(currentUTC(),'yyyyMMdd_HHmm'),'.csv'))],\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tPipeline,\n\t\t{Date of Business},\n\t\t{Batch Window},\n\t\t{Row Count},\n\t\t{Pipeline Start Dttm},\n\t\t{Pipeline End Dttm},\n\t\t{Pipeline Status}\n\t),\n\tpartitionBy('hash', 1)) ~> SinkAudit\nFlattenEvents sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SinkEvent\nFlattenComps sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tprintedCheckId,\n\t\tamount = comps.amount,\n\t\tcreatedOn = comps.createdOn,\n\t\tid = comps.id,\n\t\tlabel = comps.label,\n\t\tnote = comps.note,\n\t\t{responsibleEmployees.employee.id} = comps.responsibleEmployees.employee.id,\n\t\t{responsibleEmployees.employee.name} = comps.responsibleEmployees.employee.name,\n\t\ttype = comps.type,\n\t\ttypeId = comps.typeId\n\t)) ~> SinkChecksComps\nFlattenSurcharge sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\t{surchages.linkedItems} = surcharges.linkedItems,\n\t\trate = surcharges.rate,\n\t\ttype = surcharges.type,\n\t\taccounting = surcharges.accounting,\n\t\ttaxableSales = surcharges.taxableSales,\n\t\tid = surcharges.id,\n\t\ttypeId = surcharges.typeId,\n\t\tlabel = surcharges.label,\n\t\tamount = surcharges.amount,\n\t\tcreatedOn = surcharges.createdOn,\n\t\tprintedCheckId\n\t)) ~> SinkSurcharges\nFlattenPayments sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\ttip = payments.tip,\n\t\ttype = payments.type,\n\t\tcard = payments.card,\n\t\tid = payments.id,\n\t\ttypeId = payments.typeId,\n\t\tlabel = payments.label,\n\t\tamount = payments.amount,\n\t\tcreatedOn = payments.createdOn,\n\t\t{responsibleEmployees.employee.id} = payments.responsibleEmployees.employee.id,\n\t\t{responsibleEmployees.employee.name} = payments.responsibleEmployees.employee.name,\n\t\tprintedCheckId\n\t)) ~> SinkChecksPayments\nFlattenResponsibleEmpolyees sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tprintedCheckId,\n\t\t{responsibleEmployees.employee.id} = responsibleEmpolyees.id,\n\t\tisTippableEmployee = responsibleEmpolyees.isTippableEmployee,\n\t\t{responsibleEmployees.employee.name} = responsibleEmpolyees.name,\n\t\troleId = responsibleEmpolyees.roleId,\n\t\troleName = responsibleEmpolyees.roleName,\n\t\tshiftId = responsibleEmpolyees.shiftId,\n\t\ttime = responsibleEmpolyees.time\n\t)) ~> SinkResponsibleEmployees\nFlattenItems sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true,\n\tmapColumn(\n\t\tstoreId,\n\t\tdob,\n\t\tprintedCheckId,\n\t\tamount = items.amount,\n\t\tcreatedOn = items.createdOn,\n\t\tgiftCard = items.giftCard,\n\t\tid = items.id,\n\t\tlabel = items.label,\n\t\t{modifierInfo.id.id} = items.modifierInfo.id.id,\n\t\t{modifierInfo.id.label} = items.modifierInfo.id.label,\n\t\t{modifierInfo.type} = items.modifierInfo.type,\n\t\tnetAmount = items.netAmount,\n\t\t{orderMode.id} = items.orderMode.id,\n\t\t{orderMode.label} = items.orderMode.label,\n\t\toriginalPrice = items.originalPrice,\n\t\tparentItemId = items.parentItemId,\n\t\t{period.id} = items.period.id,\n\t\t{period.label} = items.period.label,\n\t\tprocessedInKitchen = items.processedInKitchen,\n\t\tquantity = items.quantity,\n\t\t{responsibleEmployees.employee.id} = items.responsibleEmployees.employee.id,\n\t\t{responsibleEmployees.employee.name} = items.responsibleEmployees.employee.name,\n\t\trevenue = items.revenue,\n\t\tseat = items.seat,\n\t\ttypeId = items.typeId,\n\t\tresponsibleEmployeeId = items.responsibleEmployeeId\n\t)) ~> SinkChecksItems"
				}
			},
			"dependsOn": []
		}
	]
}